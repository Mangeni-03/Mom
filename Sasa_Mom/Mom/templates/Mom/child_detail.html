{% extends "main.html" %}
{% block content %}

<div class="container mt-4 d-flex justify-content-center">
    <div class="card shadow-lg p-5" style="width: 750px; border-radius: 18px;">
        
        <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
            <h2 class="fw-bold text-primary" style="font-size: 2rem;">
                <i class="bi bi-person-badge me-2"></i>{{ child.name }}'s Health Profile
            </h2>
            
            {# RESTRICTED ACTION: Only superusers can edit child details #}
            {% if request.user.is_superuser %}
            <a href="{% url 'edit_child' child.id %}" class="btn btn-warning btn-sm">
                <i class="bi bi-pencil-square me-1"></i> Edit Details
            </a>
            {% endif %}
        </div>

        <div class="row mb-5 border p-3 rounded-3 bg-light">
            <div class="col-md-4">
                <p class="mb-1 text-muted">Gender</p>
                <p class="fw-bold text-capitalize" style="font-size: 1.15rem;">{{ child.gender }}</p>
            </div>
            <div class="col-md-4">
                <p class="mb-1 text-muted">Date of Birth</p>
                <p class="fw-bold text-success" style="font-size: 1.15rem;">{{ child.dob|date:"F d, Y" }}</p>
            </div>
            <div class="col-md-4">
                <p class="mb-1 text-muted">Registered Mother</p>
                <p class="fw-bold">
                    <a href="{% url 'motherPage' child.mother.id %}" class="text-decoration-none">{{ child.mother.name }}</a>
                </p>
            </div>
        </div>

        <h3 class="fw-bold mb-3 text-danger"><i class="bi bi-calendar-x me-2"></i>Upcoming Vaccination Schedule</h3>

        <ul class="list-group mb-5">
            {% for v in upcoming_vaccinations %}
                {% if not v.completed %}
                    <li class="list-group-item d-flex justify-content-between align-items-center py-3 alert-warning border-start border-2 border-danger">
                        <span>
                            <strong>{{ v.vaccination.name }}</strong> ({{ v.vaccination.dose_number }})<br>
                            <small class="text-muted"><i class="bi bi-clock me-1"></i> Scheduled on <span class="fw-bold text-danger">{{ v.scheduled_date|date:"F d, Y" }}</span></small>
                        </span>

                        {# Action Form to Mark as Done (Typically allowed for all authenticated staff) #}
                        <form action="{% url 'complete_vaccination' v.id %}" method="POST" class="d-inline">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-sm btn-success fw-semibold">
                                <i class="bi bi-check-lg me-1"></i> Mark as Done
                            </button>
                        </form>
                    </li>
                {% endif %}
            {% empty %}
                <li class="list-group-item text-center text-muted py-3 bg-light border">
                    <i class="bi bi-patch-check me-2 text-success"></i> All scheduled vaccinations are complete or none are pending.
                </li>
            {% endfor %}
        </ul>

        <h3 class="fw-bold mb-3 text-success"><i class="bi bi-card-checklist me-2"></i>Completed Vaccinations History</h3>
        
        <ul class="list-group mb-4">
            {% for v in completed_vaccinations %}
                <li class="list-group-item d-flex justify-content-between align-items-center py-2 bg-light">
                    <span>
                        <strong>{{ v.vaccination.name }}</strong> ({{ v.vaccination.dose_number }})<br>
                        <small class="text-success"><i class="bi bi-calendar-check me-1"></i> Completed on {{ v.completion_date|default:"[Date Not Recorded]"|date:"F d, Y" }}</small>
                    </span>
                    <span class="badge bg-success p-2">DONE</span>
                </li>
            {% empty %}
                <li class="list-group-item text-center text-muted py-3">
                    No completed vaccination records found.
                </li>
            {% endfor %}
        </ul>


        <div class="d-flex justify-content-between gap-3 pt-4 border-top">
            <a href="{% url 'schedule_child_vaccination' child.id %}" 
                class="btn btn-primary py-2 fs-6 fw-semibold flex-grow-1">
                <i class="bi bi-calendar-plus me-2"></i> Schedule New Vaccination
            </a>

            <a href="{% url 'motherPage' child.mother.id %}" 
                class="btn btn-secondary py-2 fs-6">
                <i class="bi bi-arrow-left me-2"></i> Back to Mother
            </a>
        </div>

    </div>
</div>
{% endblock %}